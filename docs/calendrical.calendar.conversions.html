<!DOCTYPE html>

<html>
<head>
  <title>calendrical.calendar.conversions.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="calendrical.astro.html">
                calendrical.astro.js
              </a>
            
              
              <a class="source" href="calendrical.calendar.base.html">
                calendrical.calendar.base.js
              </a>
            
              
              <a class="source" href="calendrical.calendar.calc.html">
                calendrical.calendar.calc.js
              </a>
            
              
              <a class="source" href="calendrical.calendar.constants.html">
                calendrical.calendar.constants.js
              </a>
            
              
              <a class="source" href="calendrical.calendar.conversions.html">
                calendrical.calendar.conversions.js
              </a>
            
              
              <a class="source" href="calendrical.date.html">
                calendrical.date.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>calendrical.calendar.conversions.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">var</span> Calendrical = (<span class="keyword">function</span>(exports){
  <span class="string">"use strict"</span>;

  exports.calendar = exports.calendar || {};</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Aliases</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> astro    = exports.astro,
      calendar = exports.calendar;</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Is a given year in the Gregorian calendar a leap year?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.leapGregorian = <span class="keyword">function</span>(year) {
    <span class="keyword">return</span> ((year % <span class="number">4</span>) == <span class="number">0</span>) &amp;&amp;
      (!(((year % <span class="number">100</span>) == <span class="number">0</span>) &amp;&amp; ((year % <span class="number">400</span>) != <span class="number">0</span>)));
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Determine Julian day number from Gregorian calendar date</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.gregorianToJd = <span class="keyword">function</span>(year, month, day) {
    <span class="keyword">return</span> (<span class="keyword">this</span>.constants.gregorian.EPOCH - <span class="number">1</span>) +
      (<span class="number">365</span> * (year - <span class="number">1</span>)) +
      Math.floor((year - <span class="number">1</span>) / <span class="number">4</span>) +
      (-Math.floor((year - <span class="number">1</span>) / <span class="number">100</span>)) +
      Math.floor((year - <span class="number">1</span>) / <span class="number">400</span>) +
      Math.floor((((<span class="number">367</span> * month) - <span class="number">362</span>) / <span class="number">12</span>) +
        ((month &lt;= <span class="number">2</span>) ? <span class="number">0</span> :
          (<span class="keyword">this</span>.leapGregorian(year) ? -<span class="number">1</span> : -<span class="number">2</span>)
        ) +
        day);
  }

  calendar.jdToGregorianYear = <span class="keyword">function</span>(jd) {
    <span class="keyword">var</span> wjd, depoch, quadricent, dqc, cent, dcent, quad, dquad,
      yindex, year;

    wjd        = Math.floor(jd - <span class="number">0.5</span>) + <span class="number">0.5</span>;
    depoch     = wjd - <span class="keyword">this</span>.constants.gregorian.EPOCH;
    quadricent = Math.floor(depoch / <span class="number">146097</span>);
    dqc        = astro.mod(depoch, <span class="number">146097</span>);
    cent       = Math.floor(dqc / <span class="number">36524</span>);
    dcent      = astro.mod(dqc, <span class="number">36524</span>);
    quad       = Math.floor(dcent / <span class="number">1461</span>);
    dquad      = astro.mod(dcent, <span class="number">1461</span>);
    yindex     = Math.floor(dquad / <span class="number">365</span>);
    year       = (quadricent * <span class="number">400</span>) + (cent * <span class="number">100</span>) + (quad * <span class="number">4</span>) + yindex;

    <span class="keyword">if</span> (!((cent == <span class="number">4</span>) || (yindex == <span class="number">4</span>))) { year++; }

    <span class="keyword">return</span> year;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Calculate Gregorian calendar date from Julian day</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.jdToGregorian = <span class="keyword">function</span>(jd) {
    <span class="keyword">var</span> wjd, year, yearday, leapadj, month, day;

    wjd = Math.floor(jd - <span class="number">0.5</span>) + <span class="number">0.5</span>;
    year = <span class="keyword">this</span>.jdToGregorianYear(jd);

    yearday = wjd - <span class="keyword">this</span>.gregorianToJd(year, <span class="number">1</span>, <span class="number">1</span>);
    leapadj = ((wjd &lt; <span class="keyword">this</span>.gregorianToJd(year, <span class="number">3</span>, <span class="number">1</span>)) ? <span class="number">0</span> :
      (<span class="keyword">this</span>.leapGregorian(year) ? <span class="number">1</span> : <span class="number">2</span>)
    );
    month = Math.floor((((yearday + leapadj) * <span class="number">12</span>) + <span class="number">373</span>) / <span class="number">367</span>);
    day   = (wjd - <span class="keyword">this</span>.gregorianToJd(year, month, <span class="number">1</span>)) + <span class="number">1</span>;

    <span class="keyword">return</span> [year, month, day];
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Return Julian day of given ISO year, week, and day</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.nWeeks = <span class="keyword">function</span>(weekday, jd, nthweek) {
    <span class="keyword">var</span> j = <span class="number">7</span> * nthweek;

    <span class="keyword">if</span> (nthweek &gt; <span class="number">0</span>) {
      j += <span class="keyword">this</span>.previousWeekday(weekday, jd);
    } <span class="keyword">else</span> {
      j += <span class="keyword">this</span>.nextWeekday(weekday, jd);
    }

    <span class="keyword">return</span> j;
  }

  calendar.isoToJulian = <span class="keyword">function</span>(year, week, day) {
    <span class="keyword">return</span> day + <span class="keyword">this</span>.nWeeks(<span class="number">0</span>, <span class="keyword">this</span>.gregorianToJd(year - <span class="number">1</span>, <span class="number">12</span>, <span class="number">28</span>), week);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Return array of ISO (year, week, day) for Julian day</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.jdToIso = <span class="keyword">function</span>(jd) {
    <span class="keyword">var</span> year, week, day;

    year = <span class="keyword">this</span>.jdToGregorian(jd - <span class="number">3</span>)[<span class="number">0</span>];

    <span class="keyword">if</span> (jd &gt;= <span class="keyword">this</span>.isoToJulian(year + <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)) { year++; }

    week = Math.floor((jd - <span class="keyword">this</span>.isoToJulian(year, <span class="number">1</span>, <span class="number">1</span>)) / <span class="number">7</span>) + <span class="number">1</span>;
    day  = astro.jwday(jd);

    <span class="keyword">if</span> (day == <span class="number">0</span>) { day = <span class="number">7</span>; }

    <span class="keyword">return</span> [year, week, day];
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Return Julian day of given ISO year, and day of year</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.isoDayToJulian = <span class="keyword">function</span>(year, day) {
    <span class="keyword">return</span> (day - <span class="number">1</span>) + <span class="keyword">this</span>.gregorianToJd(year, <span class="number">1</span>, <span class="number">1</span>);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Return array of ISO (year, day_of_year) for Julian day</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.jdToIsoDay = <span class="keyword">function</span>(jd) {
    <span class="keyword">var</span> year, day;

    year = <span class="keyword">this</span>.jdToGregorian(jd)[<span class="number">0</span>];
    day = Math.floor(jd - <span class="keyword">this</span>.gregorianToJd(year, <span class="number">1</span>, <span class="number">1</span>)) + <span class="number">1</span>;
    <span class="keyword">return</span> [year, day];
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Pad a string to a given length with a given fill character.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.pad = <span class="keyword">function</span>(str, howlong, padwith) {
    <span class="keyword">var</span> s = str.toString();

    <span class="keyword">while</span> (s.length &lt; howlong) {
      s = padwith + s;
    }

    <span class="keyword">return</span> s;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Determine Julian day number from Julian calendar date</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.leapJulian = <span class="keyword">function</span>(year) {
    <span class="keyword">return</span> astro.mod(year, <span class="number">4</span>) == ((year &gt; <span class="number">0</span>) ? <span class="number">0</span> : <span class="number">3</span>);
  }

  calendar.julianToJd = <span class="keyword">function</span>(year, month, day) {</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Adjust negative common era years to the zero-based notation we use.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (year &lt; <span class="number">1</span>) { year++; }</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Algorithm as given in <em>Meeus, <strong>Astronomical Algorithms</strong>, Chapter 7, page 61</em></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (month &lt;= <span class="number">2</span>) {
      year--;
      month += <span class="number">12</span>;
    }

    <span class="keyword">return</span> ((Math.floor((<span class="number">365.25</span> * (year + <span class="number">4716</span>))) +
      Math.floor((<span class="number">30.6001</span> * (month + <span class="number">1</span>))) +
      day) - <span class="number">1524.5</span>);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Calculate Julian calendar date from Julian day</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.jdToJulian = <span class="keyword">function</span>(td) {
    <span class="keyword">var</span> z, a, alpha, b, c, d, e, year, month, day;

    td += <span class="number">0.5</span>;
    z = Math.floor(td);

    a = z;
    b = a + <span class="number">1524</span>;
    c = Math.floor((b - <span class="number">122.1</span>) / <span class="number">365.25</span>);
    d = Math.floor(<span class="number">365.25</span> * c);
    e = Math.floor((b - d) / <span class="number">30.6001</span>);

    month = Math.floor((e &lt; <span class="number">14</span>) ? (e - <span class="number">1</span>) : (e - <span class="number">13</span>));
    year = Math.floor((month &gt; <span class="number">2</span>) ? (c - <span class="number">4716</span>) : (c - <span class="number">4715</span>));
    day = b - d - Math.floor(<span class="number">30.6001</span> * e);</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>If year is less than 1, subtract one to convert from
a zero based date system to the common era system in
which the year -1 (1 B.C.E) is followed by year 1 (1 C.E.).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (year &lt; <span class="number">1</span>) { year--; }

    <span class="keyword">return</span> [year, month, day];
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Determine Julian day from Hebrew date</p>
<p>Is a given Hebrew year a leap year?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.hebrewLeap = <span class="keyword">function</span>(year) {
    <span class="keyword">return</span> astro.mod(((year * <span class="number">7</span>) + <span class="number">1</span>), <span class="number">19</span>) &lt; <span class="number">7</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>How many months are there in a Hebrew year (12 = normal, 13 = leap)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.hebrewYearMonths = <span class="keyword">function</span>(year) {
    <span class="keyword">return</span> <span class="keyword">this</span>.hebrewLeap(year) ? <span class="number">13</span> : <span class="number">12</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Test for delay of start of new year and to avoid
Sunday, Wednesday, and Friday as start of the new year.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.hebrewDelay1 = <span class="keyword">function</span>(year) {
    <span class="keyword">var</span> months, day, parts;

    months = Math.floor(((<span class="number">235</span> * year) - <span class="number">234</span>) / <span class="number">19</span>);
    parts  = <span class="number">12084</span> + (<span class="number">13753</span> * months);
    day    = (months * <span class="number">29</span>) + Math.floor(parts / <span class="number">25920</span>);

    <span class="keyword">if</span> (astro.mod((<span class="number">3</span> * (day + <span class="number">1</span>)), <span class="number">7</span>) &lt; <span class="number">3</span>) {
      day++;
    }

    <span class="keyword">return</span> day;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Check for delay in start of new year due to length of adjacent years</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.hebrewDelay2 = <span class="keyword">function</span>(year) {
    <span class="keyword">var</span> last, present, next;

    last    = <span class="keyword">this</span>.hebrewDelay1(year - <span class="number">1</span>);
    present = <span class="keyword">this</span>.hebrewDelay1(year);
    next    = <span class="keyword">this</span>.hebrewDelay1(year + <span class="number">1</span>);

    <span class="keyword">return</span> ((next - present) == <span class="number">356</span>) ? <span class="number">2</span> :
      (((present - last) == <span class="number">382</span>) ? <span class="number">1</span> : <span class="number">0</span>);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>How many days are in a Hebrew year?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.hebrewYearDays = <span class="keyword">function</span>(year) {
    <span class="keyword">return</span> <span class="keyword">this</span>.hebrewToJd(year + <span class="number">1</span>, <span class="number">7</span>, <span class="number">1</span>) - <span class="keyword">this</span>.hebrewToJd(year, <span class="number">7</span>, <span class="number">1</span>);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>How many days are in a given month of a given year</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.hebrewMonthDays = <span class="keyword">function</span>(year, month) {</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>First of all, dispose of fixed-length 29 day months</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (month == <span class="number">2</span> || month == <span class="number">4</span> || month == <span class="number">6</span> ||
      month == <span class="number">10</span> || month == <span class="number">13</span>) {
      <span class="keyword">return</span> <span class="number">29</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>If it&#39;s not a leap year, Adar has 29 days</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (month == <span class="number">12</span> &amp;&amp; !<span class="keyword">this</span>.hebrewLeap(year)) {
      <span class="keyword">return</span> <span class="number">29</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>If it&#39;s Heshvan, days depend on length of year</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (month == <span class="number">8</span> &amp;&amp; !(astro.mod(<span class="keyword">this</span>.hebrewYearDays(year), <span class="number">10</span>) == <span class="number">5</span>)) {
      <span class="keyword">return</span> <span class="number">29</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Similarly, Kislev varies with the length of year</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (month == <span class="number">9</span> &amp;&amp; (astro.mod(<span class="keyword">this</span>.hebrewYearDays(year), <span class="number">10</span>) == <span class="number">3</span>)) {
      <span class="keyword">return</span> <span class="number">29</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Nope, it&#39;s a 30 day month</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">return</span> <span class="number">30</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Finally, wrap it all up into...</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.hebrewToJd = <span class="keyword">function</span>(year, month, day) {
    <span class="keyword">var</span> jd, mon, months;

    months = <span class="keyword">this</span>.hebrewYearMonths(year);

    jd = <span class="keyword">this</span>.constants.hebrew.EPOCH + <span class="keyword">this</span>.hebrewDelay1(year) +
      <span class="keyword">this</span>.hebrewDelay2(year) + day + <span class="number">1</span>;

    <span class="keyword">if</span> (month &lt; <span class="number">7</span>) {
      <span class="keyword">for</span> (mon = <span class="number">7</span>; mon &lt;= months; mon++) {
        jd += <span class="keyword">this</span>.hebrewMonthDays(year, mon);
      }
      <span class="keyword">for</span> (mon = <span class="number">1</span>; mon &lt; month; mon++) {
        jd += <span class="keyword">this</span>.hebrewMonthDays(year, mon);
      }
    } <span class="keyword">else</span> {
      <span class="keyword">for</span> (mon = <span class="number">7</span>; mon &lt; month; mon++) {
        jd += <span class="keyword">this</span>.hebrewMonthDays(year, mon);
      }
    }

    <span class="keyword">return</span> jd;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Convert Julian date to Hebrew date
This works by making multiple calls to
the inverse function, and is this very slow.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.jdToHebrew = <span class="keyword">function</span>(jd) {
    <span class="keyword">var</span> year, month, day, i, count, first;

    jd    = Math.floor(jd) + <span class="number">0.5</span>;
    count = Math.floor(((jd - <span class="keyword">this</span>.constants.hebrew.EPOCH) * <span class="number">98496.0</span>) / <span class="number">35975351.0</span>);
    year  = count - <span class="number">1</span>;

    <span class="keyword">for</span> (i = count; jd &gt;= <span class="keyword">this</span>.hebrewToJd(i, <span class="number">7</span>, <span class="number">1</span>); i++) {
      year++;
    }

    first = (jd &lt; <span class="keyword">this</span>.hebrewToJd(year, <span class="number">1</span>, <span class="number">1</span>)) ? <span class="number">7</span> : <span class="number">1</span>;
    month = first;

    <span class="keyword">for</span> (i = first; jd &gt; <span class="keyword">this</span>.hebrewToJd(year, i, <span class="keyword">this</span>.hebrewMonthDays(year, i)); i++) {
      month++;
    }

    day = (jd - <span class="keyword">this</span>.hebrewToJd(year, month, <span class="number">1</span>)) + <span class="number">1</span>;

    <span class="keyword">return</span> [year, month, day];
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Determine Julian day and fraction of the
September equinox at the Paris meridian in
a given Gregorian year.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.equinoxeAParis = <span class="keyword">function</span>(year) {
    <span class="keyword">var</span> equJED, equJD, equAPP, equParis, dtParis;</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>September equinox in dynamical time</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    equJED = astro.equinox(year, <span class="number">2</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Correct for delta T to obtain Universal time</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    equJD = equJED - (astro.deltat(year) / (<span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Apply the equation of time to yield the apparent time at Greenwich</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    equAPP = equJD + astro.equationOfTime(equJED);</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Finally, we must correct for the constant difference between
the Greenwich meridian and that of Paris, 2°20&#39;15&quot; to the East.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    dtParis = (<span class="number">2</span> + (<span class="number">20</span> / <span class="number">60.0</span>) + (<span class="number">15</span> / (<span class="number">60</span> * <span class="number">60.0</span>))) / <span class="number">360</span>;
    equParis = equAPP + dtParis;

    <span class="keyword">return</span> equParis;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Calculate Julian day during which the
September equinox, reckoned from the Paris
meridian, occurred for a given Gregorian year.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.parisEquinoxeJd = <span class="keyword">function</span>(year) {
    <span class="keyword">var</span> ep, epg;

    ep  = <span class="keyword">this</span>.equinoxeAParis(year);
    epg = Math.floor(ep - <span class="number">0.5</span>) + <span class="number">0.5</span>;

    <span class="keyword">return</span> epg;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Determine the year in the French
revolutionary calendar in which a given Julian day falls.
Returns an array of two elements:</p>
<p><strong>[0]</strong> Année de la Révolution
<strong>[1]</strong> Julian day number containing equinox for this year.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.anneeDaLaRevolution = <span class="keyword">function</span>(jd) {
    <span class="keyword">var</span> guess = <span class="keyword">this</span>.jdToGregorian(jd)[<span class="number">0</span>] - <span class="number">2</span>,
      lasteq, nexteq, adr;

    lasteq = <span class="keyword">this</span>.parisEquinoxeJd(guess);

    <span class="keyword">while</span> (lasteq &gt; jd) {
      guess--;
      lasteq = <span class="keyword">this</span>.parisEquinoxeJd(guess);
    }

    nexteq = lasteq - <span class="number">1</span>;

    <span class="keyword">while</span> (!((lasteq &lt;= jd) &amp;&amp; (jd &lt; nexteq))) {
      lasteq = nexteq;
      guess++;
      nexteq = <span class="keyword">this</span>.parisEquinoxeJd(guess);
    }

    adr = Math.round((lasteq - <span class="keyword">this</span>.constants.french_revolutionary.EPOCH) /
                        astro.constants.TROPICAL_YEAR) + <span class="number">1</span>;

    <span class="keyword">return</span> [adr, lasteq];
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Calculate date in the French Revolutionary
calendar from Julian day. The five or six
&quot;sansculottides&quot; are considered a thirteenth
month in the results of this function.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.jdToFrenchRevolutionary = <span class="keyword">function</span>(jd) {
    <span class="keyword">var</span> an, mois, decade, jour,
      adr, equinoxe;

    jd       = Math.floor(jd) + <span class="number">0.5</span>;
    adr      = <span class="keyword">this</span>.anneeDaLaRevolution(jd);
    an       = adr[<span class="number">0</span>];
    equinoxe = adr[<span class="number">1</span>];
    mois     = Math.floor((jd - equinoxe) / <span class="number">30</span>) + <span class="number">1</span>;
    jour     = (jd - equinoxe) % <span class="number">30</span>;
    decade   = Math.floor(jour / <span class="number">10</span>) + <span class="number">1</span>;
    jour     = (jour % <span class="number">10</span>) + <span class="number">1</span>;

    <span class="keyword">return</span> [an, mois, decade, jour];
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Obtain Julian day from a given French
Revolutionary calendar date.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.frenchRevolutionaryToJd = <span class="keyword">function</span>(an, mois, decade, jour) {
    <span class="keyword">var</span> adr, equinoxe, guess, jd;

    guess = <span class="keyword">this</span>.constants.french_revolutionary.EPOCH + (astro.constants.TROPICAL_YEAR * ((an - <span class="number">1</span>) - <span class="number">1</span>));
    adr = [an - <span class="number">1</span>, <span class="number">0</span>];

    <span class="keyword">while</span> (adr[<span class="number">0</span>] &lt; an) {
      adr = <span class="keyword">this</span>.anneeDaLaRevolution(guess);
      guess = adr[<span class="number">1</span>] + (astro.constants.TROPICAL_YEAR + <span class="number">2</span>);
    }
    equinoxe = adr[<span class="number">1</span>];

    jd = equinoxe + (<span class="number">30</span> * (mois - <span class="number">1</span>)) + (<span class="number">10</span> * (decade - <span class="number">1</span>)) + (jour - <span class="number">1</span>);
    <span class="keyword">return</span> jd;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Is a given year a leap year in the Islamic calendar?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.leapIslamic = <span class="keyword">function</span>(year) {
    <span class="keyword">return</span> (((year * <span class="number">11</span>) + <span class="number">14</span>) % <span class="number">30</span>) &lt; <span class="number">11</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Determine Julian day from Islamic date</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.islamicToJd = <span class="keyword">function</span>(year, month, day) {
    <span class="keyword">return</span> (day +
      Math.ceil(<span class="number">29.5</span> * (month - <span class="number">1</span>)) +
      (year - <span class="number">1</span>) * <span class="number">354</span> +
      Math.floor((<span class="number">3</span> + (<span class="number">11</span> * year)) / <span class="number">30</span>) +
      <span class="keyword">this</span>.constants.islamic.EPOCH) - <span class="number">1</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Calculate Islamic date from Julian day</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.jdToIslamic = <span class="keyword">function</span>(jd) {
    <span class="keyword">var</span> year, month, day;

    jd    = Math.floor(jd) + <span class="number">0.5</span>;
    year  = Math.floor(((<span class="number">30</span> * (jd - <span class="keyword">this</span>.constants.islamic.EPOCH)) + <span class="number">10646</span>) / <span class="number">10631</span>);
    month = Math.min(<span class="number">12</span>, Math.ceil((jd - (<span class="number">29</span> + <span class="keyword">this</span>.islamicToJd(year, <span class="number">1</span>, <span class="number">1</span>))) / <span class="number">29.5</span>) + <span class="number">1</span>);
    day   = (jd - <span class="keyword">this</span>.islamicToJd(year, month, <span class="number">1</span>)) + <span class="number">1</span>;

    <span class="keyword">return</span> [year, month, day];
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Determine Julian day and fraction of the
March equinox at the Tehran meridian in
a given Gregorian year.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.tehranEquinox = <span class="keyword">function</span>(year) {
    <span class="keyword">var</span> equJED, equJD, equAPP, equTehran, dtTehran;</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>March equinox in dynamical time</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    equJED = astro.equinox(year, <span class="number">0</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Correct for delta T to obtain Universal time</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    equJD = equJED - (astro.deltat(year) / (<span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Apply the equation of time to yield the apparent time at Greenwich</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    equAPP = equJD + astro.equationOfTime(equJED);</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Finally, we must correct for the constant difference between
the Greenwich meridian andthe time zone standard for
Iran Standard time, 52°30&#39; to the East.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    dtTehran  = (<span class="number">52</span> + (<span class="number">30</span> / <span class="number">60.0</span>) + (<span class="number">0</span> / (<span class="number">60.0</span> * <span class="number">60.0</span>))) / <span class="number">360</span>;
    equTehran = equAPP + dtTehran;

    <span class="keyword">return</span> equTehran;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Calculate Julian day during which the
March equinox, reckoned from the Tehran
meridian, occurred for a given Gregorian year.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.tehranEquinoxJd = <span class="keyword">function</span>(year) {
    <span class="keyword">var</span> ep, epg;

    ep  = <span class="keyword">this</span>.tehranEquinox(year);
    epg = Math.floor(ep);

    <span class="keyword">return</span> epg;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Determine the year in the Persian
astronomical calendar in which a
given Julian day falls. Returns an
array of two elements:</p>
<p><strong>[0]</strong> Persian year
<strong>[1]</strong> Julian day number containing equinox for this year.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.persianaYear = <span class="keyword">function</span>(jd) {
    <span class="keyword">var</span> guess = <span class="keyword">this</span>.jdToGregorian(jd)[<span class="number">0</span>] - <span class="number">2</span>,
      lasteq, nexteq, adr;

    lasteq = <span class="keyword">this</span>.tehranEquinoxJd(guess);

    <span class="keyword">while</span> (lasteq &gt; jd) {
      guess--;
      lasteq = <span class="keyword">this</span>.tehranEquinoxJd(guess);
    }

    nexteq = lasteq - <span class="number">1</span>;

    <span class="keyword">while</span> (!((lasteq &lt;= jd) &amp;&amp; (jd &lt; nexteq))) {
      lasteq = nexteq;
      guess++;
      nexteq = <span class="keyword">this</span>.tehranEquinoxJd(guess);
    }

    adr = Math.round((lasteq - <span class="keyword">this</span>.constants.persian.EPOCH) /
                        astro.constants.TROPICAL_YEAR) + <span class="number">1</span>;

    <span class="keyword">return</span> [adr, lasteq];
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Calculate date in the Persian astronomical
calendar from Julian day.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.jdToPersiana = <span class="keyword">function</span>(jd) {
    <span class="keyword">var</span> year, month, day, adr, equinox, yday;

    jd      = Math.floor(jd) + <span class="number">0.5</span>;
    adr     = <span class="keyword">this</span>.persianaYear(jd);
    year    = adr[<span class="number">0</span>];
    equinox = adr[<span class="number">1</span>];
    day     = Math.floor((jd - equinox) / <span class="number">30</span>) + <span class="number">1</span>;

    yday  = (Math.floor(jd) - <span class="keyword">this</span>.persianaToJd(year, <span class="number">1</span>, <span class="number">1</span>)) + <span class="number">1</span>;
    month = (yday &lt;= <span class="number">186</span>) ? Math.ceil(yday / <span class="number">31</span>) : Math.ceil((yday - <span class="number">6</span>) / <span class="number">30</span>);
    day   = (Math.floor(jd) - <span class="keyword">this</span>.persianaToJd(year, month, <span class="number">1</span>)) + <span class="number">1</span>;

    <span class="keyword">return</span> [year, month, day];
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Obtain Julian day from a given Persian
astronomical calendar date.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.persianaToJd = <span class="keyword">function</span>(year, month, day) {
    <span class="keyword">var</span> adr, equinox, guess, jd;

    guess = (<span class="keyword">this</span>.constants.persian.EPOCH - <span class="number">1</span>) +
              (astro.constants.TROPICAL_YEAR * ((year - <span class="number">1</span>) - <span class="number">1</span>));
    adr   = [year - <span class="number">1</span>, <span class="number">0</span>];

    <span class="keyword">while</span> (adr[<span class="number">0</span>] &lt; year) {
      adr   = <span class="keyword">this</span>.persianaYear(guess);
      guess = adr[<span class="number">1</span>] + (astro.constants.TROPICAL_YEAR + <span class="number">2</span>);
    }

    equinox = adr[<span class="number">1</span>];

    jd = equinox +
      ((month &lt;= <span class="number">7</span>) ?
      ((month - <span class="number">1</span>) * <span class="number">31</span>) :
      (((month - <span class="number">1</span>) * <span class="number">30</span>) + <span class="number">6</span>)
    ) +
      (day - <span class="number">1</span>);

    <span class="keyword">return</span> jd;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Is a given year a leap year in the Persian
astronomical calendar?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.leapPersiana = <span class="keyword">function</span>(year) {
    <span class="keyword">return</span> (<span class="keyword">this</span>.persianaToJd(year + <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>) -
      <span class="keyword">this</span>.persianaToJd(year, <span class="number">1</span>, <span class="number">1</span>)) &gt; <span class="number">365</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Is a given year a leap year in the Persian calendar?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.leapPersian = <span class="keyword">function</span>(year) {
    <span class="keyword">return</span> ((((((year - ((year &gt; <span class="number">0</span>) ? <span class="number">474</span> : <span class="number">473</span>)) % <span class="number">2820</span>) + <span class="number">474</span>) + <span class="number">38</span>) * <span class="number">682</span>) % <span class="number">2816</span>) &lt; <span class="number">682</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>Determine Julian day from Persian date</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.persianToJd = <span class="keyword">function</span>(year, month, day) {
    <span class="keyword">var</span> epbase, epyear;

    epbase = year - ((year &gt;= <span class="number">0</span>) ? <span class="number">474</span> : <span class="number">473</span>);
    epyear = <span class="number">474</span> + astro.mod(epbase, <span class="number">2820</span>);

    <span class="keyword">return</span> day +
      ((month &lt;= <span class="number">7</span>) ?
      ((month - <span class="number">1</span>) * <span class="number">31</span>) :
      (((month - <span class="number">1</span>) * <span class="number">30</span>) + <span class="number">6</span>)
    ) +
      Math.floor(((epyear * <span class="number">682</span>) - <span class="number">110</span>) / <span class="number">2816</span>) +
      (epyear - <span class="number">1</span>) * <span class="number">365</span> +
      Math.floor(epbase / <span class="number">2820</span>) * <span class="number">1029983</span> +
      (<span class="keyword">this</span>.constants.persian.EPOCH - <span class="number">1</span>);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>Calculate Persian date from Julian day</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.jdToPersian = <span class="keyword">function</span>(jd) {
    <span class="keyword">var</span> year, month, day, depoch, cycle, cyear, ycycle,
      aux1, aux2, yday;

    jd = Math.floor(jd) + <span class="number">0.5</span>;

    depoch = jd - <span class="keyword">this</span>.persianToJd(<span class="number">475</span>, <span class="number">1</span>, <span class="number">1</span>);
    cycle  = Math.floor(depoch / <span class="number">1029983</span>);
    cyear  = astro.mod(depoch, <span class="number">1029983</span>);

    <span class="keyword">if</span> (cyear == <span class="number">1029982</span>) {
      ycycle = <span class="number">2820</span>;
    } <span class="keyword">else</span> {
      aux1 = Math.floor(cyear / <span class="number">366</span>);
      aux2 = astro.mod(cyear, <span class="number">366</span>);
      ycycle = Math.floor(((<span class="number">2134</span> * aux1) + (<span class="number">2816</span> * aux2) + <span class="number">2815</span>) / <span class="number">1028522</span>) +
        aux1 + <span class="number">1</span>;
    }

    year = ycycle + (<span class="number">2820</span> * cycle) + <span class="number">474</span>;

    <span class="keyword">if</span> (year &lt;= <span class="number">0</span>) { year--; }

    yday  = (jd - <span class="keyword">this</span>.persianToJd(year, <span class="number">1</span>, <span class="number">1</span>)) + <span class="number">1</span>;
    month = (yday &lt;= <span class="number">186</span>) ? Math.ceil(yday / <span class="number">31</span>) : Math.ceil((yday - <span class="number">6</span>) / <span class="number">30</span>);
    day   = (jd - <span class="keyword">this</span>.persianToJd(year, month, <span class="number">1</span>)) + <span class="number">1</span>;

    <span class="keyword">return</span> [year, month, day];
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>Determine Julian day from Mayan long count</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.mayanCountToJd = <span class="keyword">function</span>(baktun, katun, tun, uinal, kin) {
    <span class="keyword">return</span> <span class="keyword">this</span>.constants.mayan.COUNT_EPOCH +
      (baktun * <span class="number">144000</span>) +
      (katun * <span class="number">7200</span>) +
      (tun * <span class="number">360</span>) +
      (uinal * <span class="number">20</span>) +
      kin;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>Calculate Mayan long count from Julian day</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.jdToMayanCount = <span class="keyword">function</span>(jd) {
    <span class="keyword">var</span> d, baktun, katun, tun, uinal, kin;

    jd     = Math.floor(jd) + <span class="number">0.5</span>;
    d      = jd - <span class="keyword">this</span>.constants.mayan.COUNT_EPOCH;
    baktun = Math.floor(d / <span class="number">144000</span>);
    d      = astro.mod(d, <span class="number">144000</span>);
    katun  = Math.floor(d / <span class="number">7200</span>);
    d      = astro.mod(d, <span class="number">7200</span>);
    tun    = Math.floor(d / <span class="number">360</span>);
    d      = astro.mod(d, <span class="number">360</span>);
    uinal  = Math.floor(d / <span class="number">20</span>);
    kin    = astro.mod(d, <span class="number">20</span>);

    <span class="keyword">return</span> [baktun, katun, tun, uinal, kin];
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>Determine Mayan Haab &quot;month&quot; and day from Julian day</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.jdToMayanHaab = <span class="keyword">function</span>(jd) {
    <span class="keyword">var</span> lcount, day;

    jd     = Math.floor(jd) + <span class="number">0.5</span>;
    lcount = jd - <span class="keyword">this</span>.constants.mayan.COUNT_EPOCH;
    day    = astro.mod(lcount + <span class="number">8</span> + ((<span class="number">18</span> - <span class="number">1</span>) * <span class="number">20</span>), <span class="number">365</span>);

    <span class="keyword">return</span> [Math.floor(day / <span class="number">20</span>) + <span class="number">1</span>, astro.mod(day, <span class="number">20</span>)];
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>Determine Mayan Tzolkin &quot;month&quot; and day from Julian day</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.jdToMayanTzolkin = <span class="keyword">function</span>(jd) {
    <span class="keyword">var</span> lcount;

    jd     = Math.floor(jd) + <span class="number">0.5</span>;
    lcount = jd - <span class="keyword">this</span>.constants.mayan.COUNT_EPOCH;

    <span class="keyword">return</span> [astro.amod(lcount + <span class="number">20</span>, <span class="number">20</span>), astro.amod(lcount + <span class="number">4</span>, <span class="number">13</span>)];
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>Determine Julian day from Bahai date</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.bahaiToJd = <span class="keyword">function</span>(major, cycle, year, month, day) {
    <span class="keyword">var</span> gy;

    gy = (<span class="number">361</span> * (major - <span class="number">1</span>)) + (<span class="number">19</span> * (cycle - <span class="number">1</span>)) + (year - <span class="number">1</span>) +
      <span class="keyword">this</span>.jdToGregorian(<span class="keyword">this</span>.constants.bahai.EPOCH)[<span class="number">0</span>];
    <span class="keyword">return</span> <span class="keyword">this</span>.gregorianToJd(gy, <span class="number">3</span>, <span class="number">20</span>) + (<span class="number">19</span> * (month - <span class="number">1</span>)) +
      ((month != <span class="number">20</span>) ? <span class="number">0</span> : (<span class="keyword">this</span>.leapGregorian(gy + <span class="number">1</span>) ? -<span class="number">14</span> : -<span class="number">15</span>)) +
      day;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>Calculate Bahai date from Julian day</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.jdToBahai = <span class="keyword">function</span>(jd) {
    <span class="keyword">var</span> major, cycle, year, month, day,
      gy, bstarty, bys, days, bld;

    jd      = Math.floor(jd) + <span class="number">0.5</span>;
    gy      = <span class="keyword">this</span>.jdToGregorian(jd)[<span class="number">0</span>];
    bstarty = <span class="keyword">this</span>.jdToGregorian(<span class="keyword">this</span>.constants.bahai.EPOCH)[<span class="number">0</span>];
    bys     = gy - (bstarty + (((<span class="keyword">this</span>.gregorianToJd(gy, <span class="number">1</span>, <span class="number">1</span>) &lt;= jd) &amp;&amp;
                (jd &lt;= <span class="keyword">this</span>.gregorianToJd(gy, <span class="number">3</span>, <span class="number">20</span>))) ? <span class="number">1</span> : <span class="number">0</span>));
    major   = Math.floor(bys / <span class="number">361</span>) + <span class="number">1</span>;
    cycle   = Math.floor(astro.mod(bys, <span class="number">361</span>) / <span class="number">19</span>) + <span class="number">1</span>;
    year    = astro.mod(bys, <span class="number">19</span>) + <span class="number">1</span>;
    days    = jd - <span class="keyword">this</span>.bahaiToJd(major, cycle, year, <span class="number">1</span>, <span class="number">1</span>);
    bld     = <span class="keyword">this</span>.bahaiToJd(major, cycle, year, <span class="number">20</span>, <span class="number">1</span>);
    month   = (jd &gt;= bld) ? <span class="number">20</span> : (Math.floor(days / <span class="number">19</span>) + <span class="number">1</span>);
    day     = (jd + <span class="number">1</span>) - <span class="keyword">this</span>.bahaiToJd(major, cycle, year, month, <span class="number">1</span>);

    <span class="keyword">return</span> [major, cycle, year, month, day];
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>Obtain Julian day for Indian Civil date</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.indianCivilToJd = <span class="keyword">function</span>(year, month, day) {
    <span class="keyword">var</span> Caitra, gyear, leap, start, jd, m;

    gyear  = year + <span class="number">78</span>;
    leap   = <span class="keyword">this</span>.leapGregorian(gyear); <span class="comment">// Is this a leap year ?</span>
    start  = <span class="keyword">this</span>.gregorianToJd(gyear, <span class="number">3</span>, leap ? <span class="number">21</span> : <span class="number">22</span>);
    Caitra = leap ? <span class="number">31</span> : <span class="number">30</span>;

    <span class="keyword">if</span> (month == <span class="number">1</span>) {
      jd = start + (day - <span class="number">1</span>);
    } <span class="keyword">else</span> {
      jd = start + Caitra;
      m = month - <span class="number">2</span>;
      m = Math.min(m, <span class="number">5</span>);
      jd += m * <span class="number">31</span>;

      <span class="keyword">if</span> (month &gt;= <span class="number">8</span>) {
        m = month - <span class="number">7</span>;
        jd += m * <span class="number">30</span>;
      }

      jd += day - <span class="number">1</span>;
    }

    <span class="keyword">return</span> jd;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>Calculate Indian Civil date from Julian day</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  calendar.jdToIndianCivil = <span class="keyword">function</span>(jd) {
    <span class="keyword">var</span> Caitra, Saka, greg, greg0, leap, start, year, month, day, yday, mday;</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>Offset in years from Saka era to Gregorian epoch</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Saka  = <span class="number">79</span> - <span class="number">1</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>Day offset between Saka and Gregorian</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    start = <span class="number">80</span>;

    jd     = Math.floor(jd) + <span class="number">0.5</span>;
    greg   = <span class="keyword">this</span>.jdToGregorian(jd); <span class="comment">// Gregorian date for Julian day</span>
    leap   = <span class="keyword">this</span>.leapGregorian(greg[<span class="number">0</span>]); <span class="comment">// Is this a leap year?</span>
    year   = greg[<span class="number">0</span>] - Saka; <span class="comment">// Tentative year in Saka era</span>
    greg0  = <span class="keyword">this</span>.gregorianToJd(greg[<span class="number">0</span>], <span class="number">1</span>, <span class="number">1</span>); <span class="comment">// JD at start of Gregorian year</span>
    yday   = jd - greg0; <span class="comment">// Day number (0 based) in Gregorian year</span>
    Caitra = leap ? <span class="number">31</span> : <span class="number">30</span>; <span class="comment">// Days in Caitra this year</span>

    <span class="keyword">if</span> (yday &lt; start) {</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>Day is at the end of the preceding Saka year</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      year--;
      yday += Caitra + (<span class="number">31</span> * <span class="number">5</span>) + (<span class="number">30</span> * <span class="number">3</span>) + <span class="number">10</span> + start;
    }

    yday -= start;

    <span class="keyword">if</span> (yday &lt; Caitra) {
      month = <span class="number">1</span>;
      day = yday + <span class="number">1</span>;
    } <span class="keyword">else</span> {
      mday = yday - Caitra;
      <span class="keyword">if</span> (mday &lt; (<span class="number">31</span> * <span class="number">5</span>)) {
        month = Math.floor(mday / <span class="number">31</span>) + <span class="number">2</span>;
        day = (mday % <span class="number">31</span>) + <span class="number">1</span>;
      } <span class="keyword">else</span> {
        mday -= <span class="number">31</span> * <span class="number">5</span>;
        month = Math.floor(mday / <span class="number">30</span>) + <span class="number">7</span>;
        day = (mday % <span class="number">30</span>) + <span class="number">1</span>;
      }
    }

    <span class="keyword">return</span> [year, month, day];
  }

  <span class="keyword">return</span> exports;
}(Calendrical || {}));</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
